# Лабораторная работа №2 по Python  
## Мини-оболочка (shell) с файловыми командами

Данный файл является `README.md` к лабораторной работе №2 по программированию на Python — реализация мини-оболочки shell с файловыми командами.

В качестве основного варианта был выбран **Medium**. Помимо базовых команд `ls`, `cd`, `cat`, `cp`, `mv`, `rm`, реализованы также команды `grep`, `undo`, `history`, работа с архивами (`zip/unzip`, `tar/untar`) и система логирования всех операций.

---

## Структура репозитория

### 1. Папка `src/`
Содержит реализацию мини-оболочки.

- `main.py` — основной цикл программы  
- `ls.py`, `cd.py`, `cat.py`, `cp.py`, `mv.py`, `rm.py` — базовые команды оболочки  
- `grep.py` — поиск подстроки в файлах  
- `history.py` — вывод ранее введённых команд  
- `command_undo.py` — реализация команды `undo`  
- `archives.py` — работа с архивами (`zip`, `tar`)  
- `log.py` — модуль логирования  

### 2. Папка `tests/`
Автоматические тесты на `pytest`, охватывающие ключевые функции оболочки.

### 3. `.gitignore`
Исключает временные файлы, виртуальные окружения, логи и системные артефакты.

### 4. `.pre-commit-config.yaml`
Настроенные хуки `pre-commit` для проверки качества кода.

### 5. `pyproject.toml`
Метаданные проекта и зависимости.

### 6. `requirements.txt`
Зависимости для запуска тестов (`pytest`, `pytest-cov`).

### 7. `uv.lock`
Lock-файл зависимостей, автоматически созданный менеджером пакетов.

---

## Описание проекта

Программа представляет собой мини-shell на Python и поддерживает следующие команды:

### 1. `ls`
Вывод содержимого директории.

Поддержка:
- `ls` — обычный вывод  
- `ls -l` — детальный вывод (размер, дата изменения)  
- `ls path` — вывод содержимого указанного пути  

### 2. `cd`
Изменение текущей директории.

Поддержка:
- `cd` — переход в домашний каталог  
- `cd path` — переход в указанную папку  

### 3. `cat`
Вывод содержимого текстового файла.

Поддержка:
- `cat file.txt`

### 4. `cp`
Копирование файла или папки.

Поддержка:
- `cp file.txt new.txt`  
- `cp file.txt dir/`  
- `cp -r folder new_folder`  

### 5. `mv`
Перемещение или переименование файлов.

Поддержка:
- `mv file.txt newname.txt`  
- `mv file.txt folder/`  

### 6. `rm`
Удаление файла или каталога.

Поддержка:
- `rm file`  
- `rm -r folder`  
- Перед удалением запрашивается подтверждение (`y/n`)  

### 7. `grep`
Поиск текста в файлах.

Поддержка:
- `grep pattern file.txt`  
- Поиск по нескольким файлам  
- Опции:
  - `-i` — игнор регистра  
  - `-r` — рекурсивный поиск  
  - `-ri` — рекурсивный поиск с игнором регистра  

### 8. `history`
История всех введённых команд.

Поддержка:
- `history` — вывод списка команд  
- История хранится в файле `.history.txt`  
- Нумерация команд генерируется автоматически  

### 9. `undo`
Откат последней файловой операции.

Поддерживается откат:
- `cp`  
- `mv`  
- `rm`  

Механизм:
- для `rm` файл перемещается из `.trash`  
- для `cp` удаляется созданная копия  
- для `mv` файл возвращается на исходное место  

### 10. Архивы (`zip`, `unzip`, `tar`, `untar`)
Работа с архивами.

Поддержка:
- `zip folder archive.zip`  
- `unzip archive.zip folder/`  
- `tar folder archive.tar.gz`  
- `untar archive.tar.gz folder/`  

---

## Тестирование

Для проекта написаны автоматические тесты на `pytest`.

### Покрытие тестами

#### `ls`
Проверяется:
- `FileNotFoundError` при неверном пути  
- вывод файла  
- вывод каталога  
- формат `-l`  
- работа по умолчанию  

#### `cd`
Проверяется:
- переход без аргументов  
- переход в существующую папку  
- `NotADirectoryError` при попытке перейти в файл  
- `FileNotFoundError` при неверном пути  

#### `cat`
Проверяется:
- корректное чтение файла  
- `FileNotFoundError`  
- `IsADirectoryError`  

#### `cp`
Проверяется:
- файл → файл  
- файл → папка  
- ошибка при отсутствии источника  
- ошибка при копировании папки без `-r`  
- рекурсивное копирование  

#### `mv`
Проверяется:
- переименование файла  
- перенос файла в директорию  
- `FileNotFoundError`  
- логирование ошибок  

#### `rm`
Проверяется:
- удаление файла (подтверждение `y/n`)  
- удаление каталога с `-r`  
- ошибка при удалении каталога без `-r`  
- ошибка для несуществующего пути  

#### `grep`
Проверяется:
- поиск строки в файле  
- поиск с `-i`  
- поиск с `-r`  
- поиск с `-ri`  
- отсутствие совпадений  
- `FileNotFoundError`  

#### `undo`
Проверяется:
- откат копирования  
- откат перемещения  
- восстановление удалённого объекта  
- невозможность отката при пустом `.trash`  

#### `history`
Проверяется:
- корректный вывод истории  
- запись команд в файл истории  

#### Архивы
Проверяется:
- создание архива  
- распаковка в каталог  
- ошибка при отсутствии архива  

---

## Запуск программы

1. Перейти в каталог проекта:
```bash
cd python-lab2
```

2. Запустить оболочку:
```bash
python src/main.py
```

3. Использовать любую команду из списка выше.  
Логи сохраняются в файл `shell.log`.

---

## Допущения по вводу команд

- `ls` — без аргументов, с путём или с `-l`  
- `cat` — обязательно требуется файл  
- `cd` — без аргументов → `~`, с аргументом → переход по пути  
- `cp` — всегда два аргумента, для папок обязателен `-r`  
- `mv` — два аргумента, путь назначения создаётся при необходимости  
- `rm` — для каталогов обязателен `-r`, требуется подтверждение  
- `grep` — поддерживает `-i`, `-r`, `-ri`  
- `undo` — откатываются только последние операции (`cp`, `mv`, `rm`)  
- `zip` / `tar` — работают только с существующими путями  
