Лабораторная работа №2 по Python

Реализация мини-оболочки с файловыми командами (+grep, undo, архивы, история)

Данный файл является README.md к лабораторной работе №2 по программированию на Python — реализация мини-оболочки shell с файловыми командами.
В качестве основного варианта был выбран вариант Easy, однако функциональность была заметно расширена: помимо базовых команд ls, cd, cat, cp, mv, rm, реализованы также grep, undo, history, zip/unzip, tar/untar и система логирования всех операций.

⸻

Структура репозитория

	1.	Папка src/
	
Содержит реализацию мини-оболочки.

	•	main.py — основной цикл программы
	•	ls.py, cd.py, cat.py, cp.py, mv.py, rm.py — команды оболочки
	•	grep.py — поиск подстроки в файлах
	•	history.py — вывод команд, которые ранее вводил пользователь
	•	command_undo.py — реализация команды undo
	•	archives.py — работа с архивами (zip/tar)
	•	log.py — модуль логирования
⸻⸻⸻⸻⸻
	
	2.	Папка tests/
Автотесты на pytest, охватывающие ключевые функции оболочки.

	3.	Файл .gitignore
Позволяет не отслеживать временные файлы, окружения, логи и прочее.

	4.	Файл .pre-commit-config.yaml
Настроенные хуки pre-commit для проверки качества кода.

	5.	Файл pyproject.toml
Метаданные и зависимости проекта.

	6.	requirements.txt
Список зависимостей, необходимых для запуска тестов (pytest, pytest-cov).

	7.	uv.lock
Lock-файл зависимостей, автоматически созданный менеджером пакетов.

⸻

Описание проекта

Программа представляет собой мини-Shell на Python, поддерживающую следующие команды:

1. ls

Вывод содержимого директории
	•	ls — обычный вывод
	•	ls -l — детальный вывод (размер, дата изменения)
	•	ls path — вывод содержимого указанного пути

2. cd

Изменение текущей директории
	•	cd → переход в домашний каталог
	•	cd path → переход в указанную папку

3. cat

Вывод текста файла
	•	cat file.txt

4. cp

Копирование файла или папки
	•	cp file.txt new.txt
	•	cp file dir/
	•	cp -r folder new_folder

5. mv

Перемещение или переименование
	•	mv file.txt newname.txt
	•	mv file.txt folder/

6. rm

Удаление файла или каталога
	•	rm file
	•	rm -r folder
	•	перед удалением спрашивает подтверждение (y/n)

7. grep

Поиск текста в файле
	•	grep pattern file.txt
	•	поддерживаются:
	•	обычный поиск
	•	поиск по нескольким файлам
	•	опция -i — нечувствительность к регистру
	•	опция -r — рекурсивный поиск по папкам

8. history

История всех введённых команд
	•	history → вывод списка команд
	•	хранится в .history.txt
	•	номера команд генерируются автоматически

9. undo

Откат последней файловой операции:
Поддерживает отмену:
	•	cp
	•	mv
	•	rm

Механизм:
	•	для rm файл перемещается в .trash
	•	для cp удаляется созданная копия
	•	для mv файл возвращается на прежнее место

10. zip / unzip / tar / untar

Архивация:
	•	zip folder archive.zip
	•	unzip archive.zip folder/
	•	tar folder archive.tar.gz
	•	untar archive.tar.gz folder/

⸻

Тесты на команды

-ls

Проверяется:
	•	FileNotFoundError при неверном пути
	•	вывод файла
	•	вывод каталога
	•	формат -l
	•	работа по умолчанию

-cd

Проверяется:
	•	переход без аргументов
	•	переход в существующую папку
	•	NotADirectoryError при попытке “зайти” в файл
	•	FileNotFoundError при неверном пути

-cat

Проверяется:
	•	корректное чтение
	•	FileNotFoundError
	•	IsADirectoryError

-cp

Проверяется:
	•	файл→файл
	•	файл→папка
	•	ошибка при отсутствии источника
	•	ошибка при копировании папки без -r
	•	рекурсивное копирование

-mv

Проверяется:
	•	переименование файла
	•	перенос в директорию
	•	FileNotFoundError
	•	лог ошибок

-rm

Проверяется:
	•	удаление файла (y/n)
	•	удаление папки с -r
	•	ошибка без -r
	•	ошибка для несуществующего пути

-grep

Проверяется:
	•	поиск строки в файле
	•	поиск с -i
	•	поиск с -r
	•	отсутствие совпадений
	•	FileNotFoundError

-undo

Проверяется:
	•	откат копирования
	•	откат перемещения
	•	восстановление удалённого объекта
	•	невозможность отката, если в .trash ничего нет

-history

Проверяется:
	•	корректный вывод команд
	•	при вызове команды она записывается в файл истории

-zip/tar

Проверяется:
	•	создание архива
	•	распаковка в каталог
	•	ошибка при отсутствии архива

Запуск программы:

	1. Перейти в каталог проекта

    -cd python-lab2

    2. Запустить оболочку

    -python src/main.py

    3. Использовать любую команду из вышеперечисленных

    4. Логи записываются в файл shell.log.

Допущения по вводу команд:

- ls

Можно вводить без аргументов, с путём или с -l.

- cat

Обязательно должен быть указан файл.

- cd

Без аргументов → ~.
С аргументом → переход по пути.

- cp

Всегда два аргумента.
При копировании каталога обязателен -r.
Если директории назначения нет, но существует её родитель — она будет создана.

- mv

Два аргумента.
Если путь назначения не существует, он будет создан (если существует родительская директория).

- rm

Требует путь.
Для удаления каталога — обязательно -r.
Перед удалением спрашивает подтверждение.

- grep

Поддерживает:
	•	обычный поиск
	•	-i (игнор регистра)
	•	-r (поиск по каталогам)
	•	поиск в нескольких файлах подряд

- undo

Откатываются только последние операции: cp/mv/rm.
Если отката нет — пользователь получает сообщение.

- zip / tar

Работают только с существующими путями.
